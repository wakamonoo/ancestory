<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Story Details</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div id="storyContent">
      <div id="storyContainer">
        <div class="story-title-container">
          <h1 id="story-title">Story Title</h1>
        </div>
        <p id="story-origin">Origin:</p>
        <img id="story-image" alt="Story Image" />
        <div id="story-content"></div>
      </div>
    </div>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-app.js";
      import {
        getFirestore,
        doc,
        getDoc,
      } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-firestore.js";

      const firebaseConfig = {
        apiKey: "AIzaSyAy4tekaIpT8doUUP0xA2oHeI9n6JgbybU",
        authDomain: "ancestory-c068e.firebaseapp.com",
        databaseURL:
          "https://ancestory-c068e-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "ancestory-c068e",
        storageBucket: "ancestory-c068e.firebasestorage.app",
        messagingSenderId: "579709470015",
        appId: "1:579709470015:web:adbbc5cba7f4e53f617f8a",
        measurementId: "G-S5SQWC7PEM",
      };

      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);

      async function fetchStoryDetails() {
        const urlParams = new URLSearchParams(window.location.search);
        const storyId = urlParams.get("storyId");

        if (!storyId) {
          console.error("Story ID not found");
          return;
        }

        const docRef = doc(db, "Stories", storyId);
        const docSnap = await getDoc(docRef);

        if (docSnap.exists()) {
          const data = docSnap.data();
          document.getElementById("story-title").innerText = data.title;
          document.getElementById("story-origin").innerText = data.origin || "";

          const content = data.story || "";
          document.getElementById("story-content").innerHTML =
            formatStoryContent(content);

          if (data.images) {
            document.getElementById("story-image").src = data.images;
            document.getElementById("story-image").style.display = "block";
          } else {
            document.getElementById("story-image").style.display = "none";
          }
        } else {
          console.log("No such document!");
          document.getElementById("story-content").innerHTML =
            "<p>Story not found</p>";
        }
      }

      function formatStoryContent(content) {
        return content
          .split("\n")
          .map((paragraph) => {
            if (!paragraph.trim()) return "<br>";
            return `<p class="story-paragraph">${paragraph.replace(
              /(\S+)\s+/g,
              "$1 "
            )}</p>`;
          })
          .join("");
      }

      window.onload = fetchStoryDetails;
    </script>
  </body>
</html>
